---
usage: "inititialise for geth/ibft. (please see the ibft command for help on options missing help)"
args:
  configdir:
    usage: >
      The config root directory.
run:
  - command:
      exec: |
        set -e
        TUSKDIR=$(pwd)

        # read the config file fields into BBENCH_ vars.
        CONFIGVARS="${configvars}"
        eval ${READ_CONFIG}
        if ${configshow}; then eval ${SHOW_CONFIG}; exit 0; fi
        cd ${launchdir} && cd ${configdir}

        echo "Initialising in: $(pwd)"

        python3 -m venv ${BBENCH_PYENV}
        source ${BBENCH_PYENV}/bin/activate
        pip3 install -r ${TUSKDIR}/requirements.txt

        # Copy the kustomization base now, and do so regardless of whether -k
        # is set, So that subsequent commands can be used to update the network
        # configuration without clobbering any local changes to the bases
        cp -r ${TUSKDIR}/k8s/base base

        cat bench.json
        echo "Wrote: $(pwd)/bench.json"
        exit 0

        # This hasn't been needed yet
        cd ${launchdir} && cd ${BBENCH_ISTANBUL_TOOLS_SRC}
        make

        cp build/bin/istanbul ${CONFIGDIR}/bin/
        cd ${CONFIGDIR}
