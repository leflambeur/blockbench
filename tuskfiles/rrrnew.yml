---
usage: "inititialise for rrr consensus network"
args:
  configdir:
    usage: The config root directory.

run:
  - command:
      exec: |
        set -e

        TUSKDIR=$(pwd)

        # read the config file fields into BBENCH_ vars.
        CONFIGVARS="${configvars} roundlength intentphase confirmphase numcandidates numendorsers committeequorum activehorizon rrr_src"
        eval ${READ_CONFIG}
        if ${configshow}; then eval ${SHOW_CONFIG}; exit 0; fi
        cd ${launchdir} && cd ${configdir}

        echo "Initialising in: $(pwd)"

        python3 -m venv ${BBENCH_PYENV}
        source ${BBENCH_PYENV}/bin/activate
        pip3 install -r ${TUSKDIR}/requirements.txt

        # Copy the kustomization base now, and do so regardless of whether -k
        # is set, So that subsequent commands can be used to update the network
        # configuration without clobbering any local changes to the bases
        cp -r ${TUSKDIR}/k8s/base base

